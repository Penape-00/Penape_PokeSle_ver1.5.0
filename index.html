<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ポケモンスリープ 詳細評価ツール ver1.6.0</title>

<style>
  body {
    font-family: sans-serif;
    background: #a9a9a9;
    padding: 16px;
    margin: 0;
  }

  h1 {
    margin-bottom: 20px;
  }

  h2 {
    margin: 0 0 12px 0;
    font-size: 20px;
    border-left: 6px solid #4CAF50;
    padding-left: 8px;
  }

  .section-block {
    background: #f5f5f5;
    padding: 16px;
    margin-bottom: 20px;
    border-radius: 8px;
    border: 1px solid #ddd;
  }

  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 12px;
  }

  .field {
    flex: 1 1 220px;
    min-width: 220px;
  }

  label {
    display: block;
    font-weight: bold;
    margin-bottom: 4px;
  }

  select,
  input,
  button {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
    font-size: 16px;
  }

.autocomplete-wrapper {
  position: relative;
  width: 100%;
}

  .autocomplete-list {
    position: absolute; /* 検索欄の下に固定 */
    top: 100%;          /* 入力欄の真下に配置 */
    left: 0;
    right: 0;

    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-top: 4px;
    max-height: 240px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
  }

  .autocomplete-item {
    padding: 14px;
    font-size: 18px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
  }

  .autocomplete-item:last-child {
    border-bottom: none;
  }

  .autocomplete-item:hover {
    background: #e8f5e9; /* 薄い緑 */
  }

  .button-row {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    margin-top: 20px;
  }

  .btn-calc,
  .btn-clear {
    flex: 1;
    padding: 12px;
    font-size: 18px;
    border-radius: 8px; /* ← 丸みを帯びたボタン */
    border: none;
    cursor: pointer;
}  

  /* 計算ボタン（緑） */
  .btn-calc {
    background: #4CAF50;
    color: #fff;
  }

  .btn-calc:hover {
    background: #43a047;
  }

  /* クリアボタン（赤） */
  .btn-clear {
    background: #d9534f;
    color: #fff;
  }

  .btn-clear:hover {
    background: #c9302c;
  }

  .results {
    background: #dcdcdc;
    padding: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
    background: #fff;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 6px 10px;
    text-align: center;
  }

  th {
    background: #666;
    color: #fff;
  }

  @media (max-width: 480px) {
    .field {
      min-width: 100%;
    }
  }
</style>

<link rel="manifest" href="manifest.json">

</head>

<body>

<h1>ポケモンスリープ 詳細評価ツール ver1.6.0</h1>

<!-- ==================================================
     ▼ 基本情報
================================================== -->
<section class="section-block">
  <h2>基本情報</h2>

  <div class="row">
    <div class="field">
      <label>タイプ</label>
      <select id="typeSelect">
        <option value="">選択してください</option>
        <option value="ノーマル">ノーマル</option>
        <option value="ほのお">ほのお</option>
        <option value="みず">みず</option>
        <option value="でんき">でんき</option>
        <option value="くさ">くさ</option>
        <option value="こおり">こおり</option>
        <option value="かくとう">かくとう</option>
        <option value="どく">どく</option>
        <option value="じめん">じめん</option>
        <option value="ひこう">ひこう</option>
        <option value="エスパー">エスパー</option>
        <option value="むし">むし</option>
        <option value="いわ">いわ</option>
        <option value="ゴースト">ゴースト</option>
        <option value="ドラゴン">ドラゴン</option>
        <option value="あく">あく</option>
        <option value="はがね">はがね</option>
        <option value="フェアリー">フェアリー</option>
      </select>
    </div>

    <div class="field">
        <label>ポケモン</label>
        <select id="pokemonSelect">…</select>
    </div>

    <div class="field autocomplete-wrapper">
      <label>ポケモン名で検索</label>
      <input type="text" id="pokemonSearch" placeholder="例：か、ピカ、リザ…">
      <div id="autocompleteList" class="autocomplete-list"></div>
    </div>

    <div class="field">
      <label>レベル</label>
      <input type="number" id="level" value="65" min="1" max="100">
    </div>
  </div>


  <!-- ==================================================
       ▼ 食材構成
  ================================================== -->
  <h2>食材構成</h2>

  <div class="row">
    <div class="field">
      <label>Lv1 食材</label>
      <select id="ingredientLv1">
        <option value="">ポケモンを選択してください</option>
      </select>
    </div>

    <div class="field">
      <label>Lv30 食材</label>
      <select id="ingredientLv30">
        <option value="">ポケモンを選択してください</option>
      </select>
    </div>

    <div class="field">
      <label>Lv60 食材</label>
      <select id="ingredientLv60">
        <option value="">ポケモンを選択してください</option>
      </select>
    </div>
  </div>

  <!-- ==================================================
       ▼ 性格・サブスキル
  ================================================== -->
  <h2>性格・サブスキル</h2>

  <div class="row">
    <div class="field">
      <label>性格</label>
      <select id="natureSelect">
        <option value="">未選択</option>
        <option value="hardy">がんばりや（無補正）</option>
        <option value="lonely">さみしがり（おてスピ up / げんき down）</option>
        <option value="brave">ゆうかん（おてスピ up / Ｅｘｐ down）</option>
        <option value="adamant">いじっぱり（おてスピ up / 食材 down）</option>
        <option value="naughty">やんちゃ（おてスピ up / スキル down）</option>
        <option value="bold">ずぶとい（げんき up / おてスピ down）</option>
        <option value="docile">すなお（無補正）</option>
        <option value="relaxed">のんき（げんき up / Ｅｘｐ down）</option>
        <option value="impish">わんぱく（げんき up / 食材 down）</option>
        <option value="lax">のうてんき（げんき up / スキル down）</option>
        <option value="timid">おくびょう（Ｅｘｐ up / おてスピ down）</option>
        <option value="hasty">せっかち（Ｅｘｐ up / げんき down）</option>
        <option value="serious">まじめ（無補正）</option>
        <option value="jolly">ようき（Ｅｘｐ up / 食材 down）</option>
        <option value="naive">むじゃき（Ｅｘｐ up / スキル down）</option>
        <option value="modest">ひかえめ（食材 up / おてスピ down）</option>
        <option value="mild">おっとり（食材 up / げんき down）</option>
        <option value="quiet">れいせい（食材 up / Ｅｘｐ down）</option>
        <option value="bashful">てれや（無補正）</option>
        <option value="rash">うっかりや（食材 up / スキル down）</option>
        <option value="calm">おだやか（スキル up / おてスピ down）</option>
        <option value="gentle">おとなしい（スキル up / げんき down）</option>
        <option value="sassy">なまいき（スキル up / Ｅｘｐ down）</option>
        <option value="careful">しんちょう（スキル up / 食材 down）</option>
        <option value="quirky">きまぐれ（無補正）</option>
      </select>
    </div>

    <div class="field">
      <label>サブスキル：おてスピ</label>
      <select id="subskillSpeed">
        <option value="0">なし</option>
        <option value="0.07">S</option>
        <option value="0.14">M</option>
        <option value="0.21">S+M</option>
      </select>
    </div>

    <div class="field">
      <label>おてボ合計数</label>
      <select id="teamBonus">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div class="field">
      <label>サブスキル：食材確率</label>
      <select id="subskillIngredient">
        <option value="0">なし</option>
        <option value="0.18">S</option>
        <option value="0.36">M</option>
        <option value="0.54">S+M</option>
      </select>
    </div>

    <div class="field">
      <label>サブスキル：スキル確率</label>
      <select id="subskillSkill">
        <option value="0">なし</option>
        <option value="0.18">S</option>
        <option value="0.36">M</option>
        <option value="0.54">S+M</option>
      </select>
    </div>

    <div class="field">
      <label>サブスキル：きのみ数</label>
      <select id="berryCountSkill">
        <option value="0">無</option>
        <option value="1">有</option>
      </select>
    </div>
  </div>

  <!-- ==================================================
       ▼ フィールド・キャンプ
  ================================================== -->
  <h2>フィールド・キャンプ</h2>

  <div class="row">
    <div class="field">
      <label>フィールドボーナス (%)</label>
      <input type="number" id="fieldBonus" value="75" min="0" max="85">
    </div>

    <div class="field">
      <label>フィールド適正</label>
      <select id="fieldBerryBonus">
        <option value="1">非該当</option>
        <option value="2">該当</option>
      </select>
    </div>

    <div class="field">
      <label>いいキャンプチケット</label>
      <select id="campTicket">
        <option value="1">不使用</option>
        <option value="1.2">使用</option>
      </select>
    </div>
  </div>

  <!-- ==================================================
       ▼ EXモード
  ================================================== -->
  <h2>EXモード</h2>

  <div class="row">
    <div class="field">
      <label>EX適正</label>
      <select id="EXtype">
        <option value="no">-</option>
        <option value="main">メイン適正</option>
        <option value="sub">サブ適正</option>
        <option value="none">非適正</option>
      </select>
    </div>

    <div class="field">
      <label>EXボーナス</label>
      <select id="EXBonus">
        <option value="no">-</option>
        <option value="exberry">きのみ</option>
        <option value="exingredient">食材</option>
        <option value="exskill">スキル</option>
      </select>
    </div>
  </div>

  <div class="button-row">
    <button id="calcBtn" class="btn-calc">計算する</button>
    <button id="clearBtn" class="btn-clear">設定をクリア</button>
  </div>
</section>

<!-- ==================================================
     ▼ 結果表示
================================================== -->
<section class="section-block results">
  <h2>結果</h2>
  <div id="summary"></div>
  <div id="tableArea"></div>
</section>


<!-- ==================================================
     ▼ ポケモン検索機能
================================================== -->
<script>
  // ひらがな → カタカナ変換
  function hiraToKana(str) {
    return str.replace(/[\u3041-\u3096]/g, ch =>
      String.fromCharCode(ch.charCodeAt(0) + 0x60)
    );
  }

  const searchInput = document.getElementById("pokemonSearch");
  const autocompleteList = document.getElementById("autocompleteList");

  searchInput.addEventListener("input", function () {
    const raw = this.value.trim();
    const keyword = hiraToKana(raw);
    const type = document.getElementById("typeSelect").value;

    autocompleteList.innerHTML = "";
    autocompleteList.style.display = "none";

    if (!keyword) return;

    let list = [];

    Object.keys(pokemonData).forEach(typeKey => {
      pokemonData[typeKey].forEach(entry => {
        const name = entry.split("|")[0];

        if (type && type !== typeKey) return;
        if (!name.startsWith(keyword)) return;

        list.push({ name, entry });
      });
    });

    list.sort((a, b) => a.name.localeCompare(b.name, "ja"));

    if (list.length === 0) return;

    list.forEach(item => {
      const div = document.createElement("div");
      div.className = "autocomplete-item";
      div.textContent = item.name;

      div.addEventListener("click", () => {
        searchInput.value = item.name;

        const select = document.getElementById("pokemonSelect");
        select.innerHTML = `<option value="${item.entry}">${item.name}</option>`;
        select.value = item.entry;

        const pokemonName = item.entry.split("|")[0];
        updateIngredientSelectors(pokemonName);

        autocompleteList.style.display = "none";
      });

      autocompleteList.appendChild(div);
    });

    autocompleteList.style.display = "block";
  });

  document.addEventListener("click", function (e) {
    if (!autocompleteList.contains(e.target) && e.target !== searchInput) {
      autocompleteList.style.display = "none";
    }
  });
</script>

<!-- ==================================================
     ▼ 性格データ（HTML に残す固定データ）
================================================== -->
<script>
  const natureModifiers = {
    hardy:   { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.492 },
    lonely:  { speed: 0.9,   ingredient: 1.0,   skill: 1.0,   genki: 0.505 },
    brave:   { speed: 0.9,   ingredient: 1.0,   skill: 1.0,   genki: 0.492 },
    adamant: { speed: 0.9,   ingredient: 0.9,   skill: 1.0,   genki: 0.492 },
    naughty: { speed: 0.9,   ingredient: 1.0,   skill: 0.9,   genki: 0.492 },
    bold:    { speed: 1.075, ingredient: 1.0,   skill: 1.0,   genki: 0.474 },
    docile:  { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.492 },
    relaxed: { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.474 },
    impish:  { speed: 1.0,   ingredient: 0.9,   skill: 1.0,   genki: 0.474 },
    lax:     { speed: 1.0,   ingredient: 1.0,   skill: 0.9,   genki: 0.474 },
    timid:   { speed: 1.075, ingredient: 1.0,   skill: 1.0,   genki: 0.492 },
    hasty:   { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.505 },
    serious: { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.492 },
    jolly:   { speed: 1.0,   ingredient: 0.9,   skill: 1.0,   genki: 0.492 },
    naive:   { speed: 1.0,   ingredient: 1.0,   skill: 0.9,   genki: 0.492 },
    modest:  { speed: 1.075, ingredient: 1.1,   skill: 1.0,   genki: 0.492 },
    mild:    { speed: 1.0,   ingredient: 1.1,   skill: 1.0,   genki: 0.505 },
    quiet:   { speed: 1.0,   ingredient: 1.1,   skill: 1.0,   genki: 0.492 },
    bashful: { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.492 },
    rash:    { speed: 1.0,   ingredient: 1.1,   skill: 0.9,   genki: 0.492 },
    calm:    { speed: 1.075, ingredient: 1.0,   skill: 1.1,   genki: 0.492 },
    gentle:  { speed: 1.0,   ingredient: 1.0,   skill: 1.1,   genki: 0.505 },
    sassy:   { speed: 1.0,   ingredient: 1.0,   skill: 1.1,   genki: 0.492 },
    careful: { speed: 1.0,   ingredient: 0.9,   skill: 1.1,   genki: 0.492 },
    quirky:  { speed: 1.0,   ingredient: 1.0,   skill: 1.0,   genki: 0.492 }
  };

  const natureLabels = {
    "": "未選択",
    hardy: "がんばりや（無補正）",
    lonely: "さみしがり（おてスピ up / げんき down）",
    brave: "ゆうかん（おてスピ up / Ｅｘｐ down）",
    adamant: "いじっぱり（おてスピ up / 食材 down）",
    naughty: "やんちゃ（おてスピ up / スキル down）",
    bold: "ずぶとい（げんき up / おてスピ down）",
    docile: "すなお（無補正）",
    relaxed: "のんき（げんき up / Ｅｘｐ down）",
    impish: "わんぱく（げんき up / 食材 down）",
    lax: "のうてんき（げんき up / スキル down）",
    timid: "おくびょう（Ｅｘｐ up / おてスピ down）",
    hasty: "せっかち（Ｅｘｐ up / げんき down）",
    serious: "まじめ（無補正）",
    jolly: "ようき（Ｅｘｐ up / 食材 down）",
    naive: "むじゃき（Ｅｘｐ up / スキル down）",
    modest: "ひかえめ（食材 up / おてスピ down）",
    mild: "おっとり（食材 up / げんき down）",
    quiet: "れいせい（食材 up / Ｅｘｐ down）",
    bashful: "てれや（無補正）",
    rash: "うっかりや（食材 up / スキル down）",
    calm: "おだやか（スキル up / おてスピ down）",
    gentle: "おとなしい（スキル up / げんき down）",
    sassy: "なまいき（スキル up / Ｅｘｐ down）",
    careful: "しんちょう（スキル up / 食材 down）",
    quirky: "きまぐれ（無補正）"
  };
</script>

<!-- ==================================================
     ▼ タイプ選択 → ポケモン候補更新
================================================== -->
<script>
  function updatePokemonList() {
    const type = document.getElementById("typeSelect").value;
    const select = document.getElementById("pokemonSelect");

    select.innerHTML = '<option value="">選択してください</option>';

    if (!pokemonData[type]) return;

    pokemonData[type].forEach(entry => {
      const name = entry.split("|")[0];
      const opt = document.createElement("option");
      opt.value = entry;
      opt.textContent = name;
      select.appendChild(opt);
    });
  }

  document.getElementById("typeSelect")
    .addEventListener("change", updatePokemonList);
</script>

<!-- ==================================================
     ▼ 食材スロット更新
================================================== -->
<script>
  function updateIngredientSelectors(pokemonName) {
    const lv1  = document.getElementById("ingredientLv1");
    const lv30 = document.getElementById("ingredientLv30");
    const lv60 = document.getElementById("ingredientLv60");

    // 未選択時はリセット
    if (!pokemonName || !ingredientOptions[pokemonName]) {
      const reset = '<option value="">ポケモンを選択してください</option>';
      lv1.innerHTML = lv30.innerHTML = lv60.innerHTML = reset;
      return;
    }

    const data = ingredientOptions[pokemonName];

    // 共通：セレクト更新
    function setOptions(selectEl, options) {
      selectEl.innerHTML = "";
      options.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item;
        opt.textContent = item;
        selectEl.appendChild(opt);
      });
      selectEl.value = options[0];
      selectEl.disabled = (options.length === 1);
    }

    setOptions(lv1,  data.level1);
    setOptions(lv30, data.level30);
    setOptions(lv60, data.level60);
  }

  document.getElementById("pokemonSelect")
    .addEventListener("change", function () {
      const selected = this.value;
      if (!selected) {
        updateIngredientSelectors(null);
        return;
      }
      const pokemonName = selected.split("|")[0];
      updateIngredientSelectors(pokemonName);
    });
</script>

<!-- ==================================================
     ▼ 設定クリア
================================================== -->
<script>
function clearSettings() {
  const ids = [
    "typeSelect", "pokemonSelect", "level",
    "natureSelect", "subskillSpeed", "subskillIngredient", "subskillSkill",
    "berryCountSkill", "teamBonus", "fieldBonus", "fieldBerryBonus",
    "campTicket", "EXtype", "EXBonus"
  ];

  ids.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;

    if (el.tagName === "SELECT") {
      el.selectedIndex = 0;
    } else if (el.type === "number") {
      el.value = (id === "level") ? 65 : 0;
    }
  });

  // ▼ 検索欄をリセット
  document.getElementById("pokemonSearch").value = "";

  // ▼ ポケモン欄を初期状態に戻す（重要）
  document.getElementById("pokemonSelect").innerHTML =
    '<option value="">タイプを選択してください</option>';

  // ▼ 食材欄も初期化（必要）
  updateIngredientSelectors(null);

  // ▼ 結果欄をクリア
  document.getElementById("summary").innerHTML = "";
  document.getElementById("tableArea").innerHTML = "";
}

  document.getElementById("clearBtn")
    .addEventListener("click", clearSettings);
</script>

<!-- ==================================================
     ▼ データファイル
================================================== -->
<script src="data/pokemonData.js"></script>
<script src="data/ingredientOptions.js"></script>
<script src="data/ingredientCounts.js"></script>
<script src="data/ingredientEnergy.js"></script>

<!-- ==================================================
     ▼ ロジック（最後に読み込む）
================================================== -->
<script src="script.js"></script>

</body>
</html>
